<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寻访模拟器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'star-6': '#FF0000',    // 6星改为红色
                        'star-5': '#FFD700',    // 5星改为金色
                        'star-4': '#800080',    // 4星改为紫色
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-4">
        <header class="text-center mb-4">
            <h1 class="text-2xl font-bold text-gray-800">寻访模拟器</h1>
            <div id="guaranteeInfo" class="text-center mb-2">
                <p class="text-sm text-gray-500">
                    <span id="sixStarGuarantee">80次寻访内必定获得6星干员</span>
                </p>
                <p class="text-sm text-gray-500">
                    <span id="upGuarantee">120次寻访内必定获得莱万汀</span>
                </p>
            </div>
        </header>

        <div class="w-full max-w-2xl mx-auto bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="mb-4">
                <label for="firstGuaranteeDraws" class="block text-sm font-medium text-gray-700 mb-1">首个小保底所需抽数 (1-80)</label>
                <div class="flex flex-col sm:flex-row gap-2 items-start sm:items-center">
                    <input type="number" id="firstGuaranteeDraws" min="1" max="80" value="80" 
                           class="w-full sm:w-auto px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <button id="applyGuaranteeBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg text-sm whitespace-nowrap">
                        应用设置
                    </button>
                </div>
            </div>
        </div>

        <div class="flex justify-center gap-4 mb-4">
            <button id="singleDrawBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 sm:px-6 rounded-lg text-sm sm:text-base whitespace-nowrap">
                寻访一次
            </button>
            <button id="tenDrawBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 sm:px-6 rounded-lg text-sm sm:text-base whitespace-nowrap">
                寻访十次
            </button>
            <button id="clearBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">
                清除记录
            </button>
        </div>

        <div class="w-full max-w-2xl mx-auto bg-white rounded-lg shadow-md p-4 mb-4">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-lg font-semibold text-gray-800">寻访记录</h2>
                <span id="totalCostDisplay" class="text-sm text-gray-600">总花费抽数: 0</span>
            </div>
            <div id="resultContainer" class="min-h-[300px] max-h-[400px] overflow-y-auto p-2 border border-gray-200 rounded-lg">
                <p class="text-gray-500 text-center">点击上方按钮开始寻访</p>
            </div>
        </div>

        <div class="w-full max-w-2xl mx-auto bg-white rounded-lg shadow-md p-4">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-lg font-semibold text-gray-800">6星记录</h2>
            </div>
            <div id="sixStarContainer" class="min-h-[200px] max-h-[300px] overflow-y-auto p-2 border border-gray-200 rounded-lg">
                <p class="text-gray-500 text-center">暂无6星干员</p>
            </div>
        </div>
    </div>

    <script>
        // DOM 元素
        const singleDrawBtn = document.getElementById('singleDrawBtn');
        const tenDrawBtn = document.getElementById('tenDrawBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultContainer = document.getElementById('resultContainer');
        const sixStarContainer = document.getElementById('sixStarContainer');
        const sixStarGuaranteeEl = document.getElementById('sixStarGuarantee');
        const upGuaranteeEl = document.getElementById('upGuarantee');

        // 全局变量
        let totalDraws = 0;
        let paidDraws = 0;
        let sixStarRecords = [];
        let drawsSinceLastHighStar = 0;
        let drawsSinceLastSixStar = 0;
        let drawsSinceLastUpSixStar = 0;
        let upGuaranteeUsed = false;
        let freeTenDrawUsed = false;
        let freeDrawsSinceLastHighStar = 0;
        let firstSixStarGuaranteeApplied = false; // 是否已经应用了首个小保底

        // 绑定事件
        singleDrawBtn.addEventListener('click', handleSingleDraw);
        tenDrawBtn.addEventListener('click', handleTenDraw);
        clearBtn.addEventListener('click', clearRecords);
        
        // 首个小保底设置事件
        const firstGuaranteeInput = document.getElementById('firstGuaranteeDraws');
        const applyGuaranteeBtn = document.getElementById('applyGuaranteeBtn');
        
        function applyGuaranteeSetting() {
            // 确保值在有效范围内
            let value = parseInt(firstGuaranteeInput.value);
            if (isNaN(value) || value < 1) {
                value = 1;
            } else if (value > 80) {
                value = 80;
            }
            firstGuaranteeInput.value = value;
            
            // 重置首个小保底状态，让新设置生效
            if (!firstSixStarGuaranteeApplied) {
                // 只有在首个小保底尚未应用时才重置计数
                drawsSinceLastSixStar = 0;
            }
            
            updateGuaranteeDisplay();
            
            // 显示应用成功提示
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            toast.textContent = '设置已应用';
            document.body.appendChild(toast);
            
            // 3秒后移除提示
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // 应用按钮点击事件
        applyGuaranteeBtn.addEventListener('click', applyGuaranteeSetting);
        
        // 输入框回车事件
        firstGuaranteeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                applyGuaranteeSetting();
            }
        });

        // 处理单寻访
        function handleSingleDraw() {
            const needFiveStarGuarantee = drawsSinceLastHighStar >= 9;
            
            // 计算6星保底需求，支持自定义首个小保底
            let needSixStarGuarantee = false;
            if (!firstSixStarGuaranteeApplied) {
                // 首个小保底：使用用户自定义的抽数
                const firstGuaranteeThreshold = parseInt(document.getElementById('firstGuaranteeDraws').value);
                needSixStarGuarantee = drawsSinceLastSixStar >= firstGuaranteeThreshold - 1;
            } else {
                // 后续小保底：80抽
                needSixStarGuarantee = drawsSinceLastSixStar >= 79;
            }
            
            const needUpGuarantee = !upGuaranteeUsed && drawsSinceLastUpSixStar >= 119;
            
            // 先检查是否触发潜能保底机制（在付费抽卡次数更新之前检查）
            const isPotentialGuarantee = paidDraws === 239; // 下一次抽卡就是第240抽
            
            const result = drawCharacter(needFiveStarGuarantee, needSixStarGuarantee, needUpGuarantee, false);
            const results = [result];
            
            // 如果触发潜能保底，直接处理（不显示在寻访记录中）
            if (isPotentialGuarantee) {
                handlePotentialGuarantee();
            }
            
            addDrawRecord(results);
            
            paidDraws++;
            
            // 实时更新总花费抽数显示
            updateTotalDrawsDisplay();
            
            if (paidDraws === 30 && !freeTenDrawUsed) {
                handleFreeTenDraw();
            }
            
            // 更新保底计数
            if (result.star === 6) {
                drawsSinceLastHighStar = 0;
                drawsSinceLastSixStar = 0;
                
                if (characterPool[6].up.includes(result.character)) {
                    drawsSinceLastUpSixStar = 0;
                    upGuaranteeUsed = true;
                } else {
                    drawsSinceLastUpSixStar++;
                }
                
                // 记录6星角色，并添加潜能信息
                const characterName = result.character;
                
                // 计算该角色的潜能等级（获取次数-1）
                const existingRecords = sixStarRecords.filter(record => record.character === characterName);
                const potentialLevel = existingRecords.length;
                
                // 查找上一个非潜能保底的6星角色记录
                const previousNonPotentialRecord = [...sixStarRecords].reverse().find(record => !record.isPotential);
                const previousSixStarDraw = previousNonPotentialRecord ? previousNonPotentialRecord.paidDraws : 0;
                const costDraws = paidDraws - previousSixStarDraw;
                
                sixStarRecords.push({
                    character: characterName,
                    paidDraws: paidDraws,
                    costDraws: costDraws,
                    isUp: characterPool[6].up.includes(characterName),
                    potentialLevel: potentialLevel
                });
                updateSixStarDisplay();
            } else if (result.star === 5) {
                drawsSinceLastHighStar = 0;
                drawsSinceLastSixStar++;
                drawsSinceLastUpSixStar++;
            } else {
                drawsSinceLastHighStar++;
                drawsSinceLastSixStar++;
                drawsSinceLastUpSixStar++;
            }
            
            updateGuaranteeDisplay();
        }

        // 处理十连寻访
        function handleTenDraw() {
            const results = [];
            
            // 检查十连抽中是否包含潜能保底点（240、480、720等）
            const startDraw = paidDraws + 1;
            const endDraw = paidDraws + 10;
            const hasPotentialGuarantee = (startDraw <= 240 && endDraw >= 240) || 
                                         (startDraw <= 480 && endDraw >= 480) ||
                                         (startDraw <= 720 && endDraw >= 720) ||
                                         (startDraw <= 960 && endDraw >= 960) ||
                                         (startDraw <= 1200 && endDraw >= 1200);
            
            for (let i = 0; i < 10; i++) {
                const needFiveStarGuarantee = drawsSinceLastHighStar >= 9;
                
                // 计算6星保底需求，支持自定义首个小保底
                let needSixStarGuarantee = false;
                if (!firstSixStarGuaranteeApplied) {
                    // 首个小保底：使用用户自定义的抽数
                    const firstGuaranteeThreshold = parseInt(document.getElementById('firstGuaranteeDraws').value);
                    needSixStarGuarantee = drawsSinceLastSixStar >= firstGuaranteeThreshold - 1;
                } else {
                    // 后续小保底：80抽
                    needSixStarGuarantee = drawsSinceLastSixStar >= 79;
                }
                
                const needUpGuarantee = !upGuaranteeUsed && drawsSinceLastUpSixStar >= 119;
                
                const result = drawCharacter(needFiveStarGuarantee, needSixStarGuarantee, needUpGuarantee, false);
                results.push(result);
                
                if (result.star === 6) {
                    drawsSinceLastHighStar = 0;
                    drawsSinceLastSixStar = 0;
                    
                    // 标记首个小保底已应用
                    firstSixStarGuaranteeApplied = true;
                    
                    // 标记首个小保底已应用
                    firstSixStarGuaranteeApplied = true;
                    
                    if (characterPool[6].up.includes(result.character)) {
                        drawsSinceLastUpSixStar = 0;
                        upGuaranteeUsed = true;
                    } else {
                        drawsSinceLastUpSixStar++;
                    }
                    
                    const currentDraw = paidDraws + i + 1;
                    // 记录6星角色，并添加潜能信息
                    const characterName = result.character;
                    
                    // 计算该角色的潜能等级（获取次数-1）
                    const existingRecords = sixStarRecords.filter(record => record.character === characterName);
                    const potentialLevel = existingRecords.length;
                    
                    // 查找上一个非潜能保底的6星角色记录
                const previousNonPotentialRecord = [...sixStarRecords].reverse().find(record => !record.isPotential);
                const previousSixStarDraw = previousNonPotentialRecord ? previousNonPotentialRecord.paidDraws : 0;
                    const costDraws = currentDraw - previousSixStarDraw;
                    
                    sixStarRecords.push({
                        character: characterName,
                        paidDraws: currentDraw,
                        costDraws: costDraws,
                        isUp: characterPool[6].up.includes(characterName),
                        potentialLevel: potentialLevel
                    });
                    updateSixStarDisplay();
                } else if (result.star === 5) {
                    drawsSinceLastHighStar = 0;
                    drawsSinceLastSixStar++;
                    drawsSinceLastUpSixStar++;
                } else {
                    drawsSinceLastHighStar++;
                    drawsSinceLastSixStar++;
                    drawsSinceLastUpSixStar++;
                }
            }
            
            // 如果十连抽中包含潜能保底点，直接处理（不显示在寻访记录中）
            if (hasPotentialGuarantee) {
                handlePotentialGuarantee();
            }
            
            addDrawRecord(results);
            updateGuaranteeDisplay();
            
            paidDraws += 10;
            
            // 实时更新总花费抽数显示
            updateTotalDrawsDisplay();
            
            if (paidDraws >= 30 && !freeTenDrawUsed) {
                handleFreeTenDraw();
            }
        }
        
        // 处理免费10连寻访
        function handleFreeTenDraw() {
            const results = [];
            
            // 进行十次免费抽卡（不影响保底计数）
            for (let i = 0; i < 10; i++) {
                // 免费抽卡不触发6星保底，但仍需触发5星保底（使用独立的保底计数）
                const needFiveStarGuarantee = freeDrawsSinceLastHighStar >= 9;
                const result = drawCharacter(needFiveStarGuarantee, false, false, true);
                results.push(result);
                
                // 更新免费抽卡的保底计数
                if (result.star === 6 || result.star === 5) {
                    freeDrawsSinceLastHighStar = 0;
                } else {
                    freeDrawsSinceLastHighStar++;
                }

                // 如果是6星角色，记录到6星记录中
                if (result.star === 6) {
                    const characterName = result.character;
                    
                    // 计算该角色的潜能等级（获取次数-1）
                    const existingRecords = sixStarRecords.filter(record => record.character === characterName);
                    const potentialLevel = existingRecords.length;
                    
                    // 查找上一个非潜能保底的6星角色记录
                const previousNonPotentialRecord = [...sixStarRecords].reverse().find(record => !record.isPotential);
                const previousSixStarDraw = previousNonPotentialRecord ? previousNonPotentialRecord.paidDraws : 0;
                    
                    sixStarRecords.push({
                        character: characterName,
                        paidDraws: previousSixStarDraw,
                        costDraws: 0, // 免费抽卡花费为0
                        isUp: characterPool[6].up.includes(characterName),
                        isFree: true,
                        potentialLevel: potentialLevel
                    });
                    updateSixStarDisplay();
                }
            }
            
            // 添加免费抽卡标记
            const freeBatchContainer = document.createElement('div');
            freeBatchContainer.className = 'mb-4 p-3 bg-blue-50 rounded-lg shadow-sm border border-blue-200';
            
            const freeTitle = document.createElement('div');
            freeTitle.className = 'text-sm font-medium text-blue-700 mb-2 pb-1 border-b border-blue-200';
            freeTitle.textContent = '免费10连';
            freeBatchContainer.appendChild(freeTitle);
            
            // 创建抽卡结果网格（响应式）
            const resultsGrid = document.createElement('div');
            resultsGrid.className = 'grid grid-cols-3 sm:grid-cols-5 gap-2';
            
            // 添加结果
            results.forEach((result, index) => {
                totalDraws++;
                
                const resultEl = document.createElement('div');
                resultEl.className = 'p-2 rounded text-center';
                
                // 根据星级设置不同的样式
                let starColor;
                switch(result.star) {
                    case 6:
                        starColor = 'text-star-6';
                        resultEl.className += ' bg-white border border-gray-200';

                        break;
                    case 5:
                        starColor = 'text-star-5';
                        resultEl.className += ' bg-white border border-gray-200';
                        break;
                    case 4:
                        starColor = 'text-star-4';
                        resultEl.className += ' bg-white border border-gray-200';
                        break;
                }
                
                resultEl.innerHTML = `
                    <div class="text-xs text-gray-500 mb-1">第 ${totalDraws} 抽</div>
                    <div class="${starColor} font-bold text-xs sm:text-sm">${result.character}</div>
                `;
                
                resultsGrid.appendChild(resultEl);
            });
            
            freeBatchContainer.appendChild(resultsGrid);
            
            // 将免费抽卡批次添加到容器顶部
            resultContainer.insertBefore(freeBatchContainer, resultContainer.firstChild);
            
            // 滚动到顶部
            resultContainer.scrollTop = 0;
            
            // 标记免费10连已使用
            freeTenDrawUsed = true;
        }
        
        // 检查是否触发潜能保底机制（每240抽赠送UP角色）
        function checkPotentialGuarantee() {
            return paidDraws === 240 || paidDraws === 480 || paidDraws === 720 || paidDraws === 960 || paidDraws === 1200;
        }
        
        // 处理潜能保底机制（每240抽赠送UP角色）
        function handlePotentialGuarantee() {
            // 直接赠送UP角色（莱万汀）
            const upCharacter = characterPool[6].up[0];
            
            // 计算该角色的潜能等级（获取次数-1）
            const existingRecords = sixStarRecords.filter(record => record.character === upCharacter);
            const potentialLevel = existingRecords.length;
            
            // 记录6星角色（只显示在6星记录中，不在寻访记录中显示）
            const previousSixStarDraw = sixStarRecords.length > 0 ? sixStarRecords[sixStarRecords.length - 1].paidDraws : 0;
            sixStarRecords.push({
                character: upCharacter,
                paidDraws: paidDraws,
                costDraws: 0, // 潜能保底花费为0抽
                isUp: true,
                isPotential: true,
                potentialLevel: potentialLevel
            });
            
            updateSixStarDisplay();
        }

        // 卡池干员数据
        const characterPool = {
            6: {
                up: ["莱万汀"],
                regular: ["别礼", "余烬", "黎风", "艾尔黛拉", "骏卫", "洁尔佩塔", "伊冯"]
            },
            5: ["佩丽卡", "陈千语", "狼卫", "赛希", "艾维文娜", "昼雪", "弧光", "大潘", "阿列什"],
            4: ["秋栗", "埃特拉", "卡契尔", "萤石", "安塔尔"]
        };

        // 寻访逻辑 - 权重型
        function drawCharacter(needFiveStarGuarantee = false, needSixStarGuarantee = false, needUpGuarantee = false, isFreeDraw = false) {
            // 总权重为10000
            const totalWeight = 10000;
            let weights;
            
            if (needUpGuarantee) {
                // UP大保底机制：必定出UP6星角色（莱万汀）
                const upIndex = Math.floor(Math.random() * characterPool[6].up.length);
                const character = characterPool[6].up[upIndex];
                return { star: 6, character };
            } else if (needSixStarGuarantee) {
                // 6星保底机制：必定出6星，但仍需选择具体角色
                let character;
                // 6星干员有UP机制：50%概率出UP干员，50%概率出非UP干员
                if (Math.random() < 0.5) {
                    // 出UP干员
                    const upIndex = Math.floor(Math.random() * characterPool[6].up.length);
                    character = characterPool[6].up[upIndex];
                } else {
                    // 出非UP干员
                    const regularIndex = Math.floor(Math.random() * characterPool[6].regular.length);
                    character = characterPool[6].regular[regularIndex];
                }
                return { star: 6, character };
            } else {
                // 先计算所有星级的权重（包括概率提升）
                let adjustedDrawsSinceLastSixStar = drawsSinceLastSixStar;
                
                // 如果是首个小保底且用户设置了自定义值，计算等效的抽数
                // 注意：概率提升只应用于付费抽卡，不应用于免费十连
                if (!firstSixStarGuaranteeApplied && !isFreeDraw) {
                    const firstGuaranteeThreshold = parseInt(document.getElementById('firstGuaranteeDraws').value);
                    const padDraws = 80 - firstGuaranteeThreshold; // 计算等效的垫抽数
                    adjustedDrawsSinceLastSixStar = drawsSinceLastSixStar + padDraws;
                }
                
                if (adjustedDrawsSinceLastSixStar >= 65) {
                    // 计算6星角色的提升权重
                    const bonusWeight = 500 * (adjustedDrawsSinceLastSixStar - 64);
                    const baseSixStarWeight = 80;
                    const newSixStarWeight = baseSixStarWeight + bonusWeight;
                    
                    // 计算剩余权重总和
                    const remainingWeight = totalWeight - newSixStarWeight;
                    
                    // 按原比例分配剩余权重给5星和4星角色
                    const originalFiveStarWeight = 800;
                    const originalFourStarWeight = 9120;
                    const originalRemainingWeight = originalFiveStarWeight + originalFourStarWeight;
                    
                    const newFiveStarWeight = Math.round(originalFiveStarWeight * remainingWeight / originalRemainingWeight);
                    const newFourStarWeight = remainingWeight - newFiveStarWeight;
                    
                    weights = {
                        6: newSixStarWeight,   // 提升后的6星角色权重
                        5: newFiveStarWeight,  // 按比例调整的5星角色权重
                        4: newFourStarWeight   // 按比例调整的4星角色权重
                    };
                } else {
                    // 初始权重
                    weights = {
                        6: 80,     // 6星角色权重
                        5: 800,    // 5星角色权重
                        4: 9120    // 4星角色权重
                    };
                }
                
                // 生成随机数
                const rand = Math.random() * totalWeight;
                
                // 根据权重确定抽卡结果
                let cumulativeWeight = 0;
                let star;
                
                // 如果触发5星保底，将4星的权重分配给5星
                if (needFiveStarGuarantee) {
                    // 计算新的总权重（将4星权重加到5星上）
                    const newFiveStarWeight = weights[5] + weights[4];
                    const newTotalWeight = weights[6] + newFiveStarWeight;
                    
                    const rand = Math.random() * newTotalWeight;
                    
                    if (rand < weights[6]) {
                        star = 6;
                    } else {
                        star = 5;
                    }
                } else {
                    // 普通抽卡，考虑所有星级
                    for (const [starLevel, weight] of Object.entries(weights)) {
                        cumulativeWeight += weight;
                        if (rand < cumulativeWeight) {
                            star = parseInt(starLevel);
                            break;
                        }
                    }
                }
                
                // 从对应星级的角色池中随机选择一个角色
                let character;
                if (star === 6) {
                    // 6星干员有UP机制：50%概率出UP干员，50%概率出非UP干员
                    if (Math.random() < 0.5) {
                        // 出UP干员
                        const upIndex = Math.floor(Math.random() * characterPool[6].up.length);
                        character = characterPool[6].up[upIndex];
                    } else {
                        // 出非UP干员
                        const regularIndex = Math.floor(Math.random() * characterPool[6].regular.length);
                        character = characterPool[6].regular[regularIndex];
                    }
                } else {
                    // 5星和4星干员正常随机
                    const pool = characterPool[star];
                    const randomIndex = Math.floor(Math.random() * pool.length);
                    character = pool[randomIndex];
                }
                
                return { star, character, isFreeDraw };
            }
        }

        // 添加寻访记录
        function addDrawRecord(results) {
            // 如果是第一次抽卡，清空初始提示
            if (totalDraws === 0) {
                resultContainer.innerHTML = '';
            }
            
            // 创建一个新的抽卡批次容器
            const batchContainer = document.createElement('div');
            batchContainer.className = 'mb-4 p-3 bg-gray-50 rounded-lg shadow-sm border border-gray-200';
            
            // 移除抽卡类型标题
            
            // 创建抽卡结果网格（响应式）
            const resultsGrid = document.createElement('div');
            resultsGrid.className = 'grid grid-cols-3 sm:grid-cols-5 gap-2';
            
            // 添加结果
            results.forEach((result, index) => {
                totalDraws++;
                
                const resultEl = document.createElement('div');
                resultEl.className = 'p-2 rounded text-center';
                
                // 根据星级设置不同的样式
                let starColor;
                switch(result.star) {
                    case 6:
                        starColor = 'text-star-6';
                        resultEl.className += ' bg-white border border-gray-200';

                        break;
                    case 5:
                        starColor = 'text-star-5';
                        resultEl.className += ' bg-white border border-gray-200';
                        break;
                    case 4:
                        starColor = 'text-star-4';
                        resultEl.className += ' bg-white border border-gray-200';
                        break;
                }
                
                resultEl.innerHTML = `
                    <div class="text-xs text-gray-500 mb-1">第 ${totalDraws} 抽</div>
                    <div class="${starColor} font-bold text-xs sm:text-sm">${result.character}</div>
                `;
                
                resultsGrid.appendChild(resultEl);
            });
            
            batchContainer.appendChild(resultsGrid);
            
            // 将新的抽卡批次添加到容器顶部
            resultContainer.insertBefore(batchContainer, resultContainer.firstChild);
            
            // 滚动到顶部
            resultContainer.scrollTop = 0;
        }

        // 更新6星记录显示
        function updateSixStarDisplay() {
            if (sixStarRecords.length === 0) {
                sixStarContainer.innerHTML = '<p class="text-gray-500 text-center">暂无6星角色</p>';
                updateTotalDrawsDisplay();
                return;
            }

            // 实时更新总花费抽数显示
            updateTotalDrawsDisplay();

            sixStarContainer.innerHTML = '';

            // 按付费抽数降序排列（新的记录在上方）
            const sortedRecords = [...sixStarRecords].sort((a, b) => b.paidDraws - a.paidDraws);



            sortedRecords.forEach((record, index) => {
                const recordEl = document.createElement('div');
                recordEl.className = 'mb-3 p-3 bg-gray-50 rounded-lg shadow-sm border border-gray-200';

                // 固定最大宽度为80抽
                const maxCostDraws = 80;
                const barWidth = Math.min((record.costDraws / maxCostDraws) * 100, 100);

                // 生成角色名称显示（包含潜能信息或NEW标识）
                let characterDisplayName = record.character;
                let extraInfo = '';
                
                if (record.potentialLevel === 0) {
                    // 首次获取，显示NEW!
                    extraInfo = '<span class="text-yellow-500 ml-1">NEW!</span>';
                } else if (record.potentialLevel >= 1 && record.potentialLevel <= 5) {
                    // 第二次到第六次获取，显示潜能等级
                    extraInfo = `<span class="text-gray-500 ml-1">（${record.potentialLevel}潜）</span>`;
                }
                // 第七次及以后获取，不显示额外信息
                
                // 根据是否是潜能保底显示不同的样式
                if (record.isPotential) {
                    // 潜能保底也显示潜能等级
                    let potentialInfo = '';
                    if (record.potentialLevel === 0) {
                        potentialInfo = '<span class="text-yellow-500 ml-1">NEW!</span>';
                    } else if (record.potentialLevel >= 1 && record.potentialLevel <= 5) {
                        potentialInfo = `<span class="text-gray-500 ml-1">（${record.potentialLevel}潜）</span>`;
                    }
                    
                    recordEl.innerHTML = `
                        <div class="flex items-center justify-between mb-1">
                            <span class="font-bold text-star-6">${record.character}${potentialInfo}</span>
                            <span class="text-sm text-yellow-600 font-medium">潜能保底</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-yellow-400 h-2.5 rounded-full" style="width: 100%"></div>
                        </div>
                    `;
                } else {
                    recordEl.innerHTML = `
                        <div class="flex items-center justify-between mb-1">
                            <span class="font-bold text-star-6">${characterDisplayName}${extraInfo}</span>
                            <span class="text-sm text-gray-600">花费 ${record.costDraws} 抽</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-star-6 h-2.5 rounded-full" style="width: ${barWidth}%"></div>
                        </div>
                    `;
                }

                sixStarContainer.appendChild(recordEl);
            });
        }

        // 更新总花费抽数显示
        function updateTotalDrawsDisplay() {
            document.getElementById('totalCostDisplay').textContent = `总花费抽数: ${paidDraws}`;
        }

        // 更新保底信息显示
        function updateGuaranteeDisplay() {
            // 计算6星保底剩余抽数，考虑自定义首个小保底
            let sixStarRemaining;
            if (!firstSixStarGuaranteeApplied) {
                const firstGuaranteeThreshold = parseInt(document.getElementById('firstGuaranteeDraws').value);
                sixStarRemaining = Math.max(0, firstGuaranteeThreshold - drawsSinceLastSixStar);
            } else {
                sixStarRemaining = Math.max(0, 80 - drawsSinceLastSixStar);
            }
            
            const upRemaining = Math.max(0, 120 - drawsSinceLastUpSixStar);
            
            sixStarGuaranteeEl.textContent = `${sixStarRemaining}次寻访内必定获得6星干员`;
            
            if (!upGuaranteeUsed) {
                upGuaranteeEl.textContent = `${upRemaining}次寻访内必定获得莱万汀`;
                upGuaranteeEl.style.display = 'inline';
            } else {
                upGuaranteeEl.style.display = 'none';
            }
        }

        // 清除寻访记录
        function clearRecords() {
            totalDraws = 0;
            paidDraws = 0;
            sixStarRecords = [];
            drawsSinceLastHighStar = 0;
            drawsSinceLastSixStar = 0;
            drawsSinceLastUpSixStar = 0;
            upGuaranteeUsed = false;
            freeTenDrawUsed = false;
            freeDrawsSinceLastHighStar = 0;
            firstSixStarGuaranteeApplied = false;
            
            resultContainer.innerHTML = '<p class="text-gray-500 text-center">点击上方按钮开始寻访</p>';
            sixStarContainer.innerHTML = '<p class="text-gray-500 text-center">暂无6星干员</p>';
            updateTotalDrawsDisplay();
            updateGuaranteeDisplay();
        }
    </script>
</body>
</html>